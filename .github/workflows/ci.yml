name: CI/CD Pipeline - Biblioteca DAM

on:
  push:
    branches: [ "main" ]  # S'executa en fer push a la branca "main"

jobs:
  build-and-test:
    name: Build i Anàlisi de Qualitat
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4  # Baixa el codi del repositori

    - name: Configurar .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x  # Canvia per la versió que utilitzis (6.0.x, 7.0.x, etc.)

    - name: Restaurar dependències
      run: dotnet restore **./BibliotecaDemo/BibliotecaDemo.slnx**
      
    - name: Compilar el projecte
      run: dotnet build **.//BibliotecaDemo/BibliotecaDemo.slnx** --configuration Release --no-restore
      
    - name: Executar tests
      # Normalment els tests estan en un projecte separat, assegura't d'apuntar al projecte de tests
      run: dotnet test **./BibliotecaDemo/BibliotecaDemo/BibliotecaDemo.csproj** --no-build --verbosity normal
      
    - name: Publicar el projecte
      run: dotnet publish **./BibliotecaDemo/BibliotecaDemo.slnx** --configuration Release --output ./publish